<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador de Tabelas de Escala</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      .autopreenchimento, .btn-imprimir, .btn-nova-tabela, .controles, .btn-excluir, .btn-add-linha, .excluir {
        display: none !important;
      }
    }
    .input-dia::-webkit-input-placeholder { color: #bbb; }
    .input-dia:-ms-input-placeholder { color: #bbb; }
    .input-dia::placeholder { color: #bbb; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container mx-auto py-6 flex">
        <img class="flex-row" src="img/pmrp.png" alt="" style="width: 500px; height: 100px;">
        <img class="flex-row ml-20" src="img/sus.jpg" alt="" style="width: 200px; height: 100px;">
    </div>
    

  <div class="container mx-auto py-6">
    <div class="controles flex flex-wrap items-end gap-2 mb-4">
      <div>
        <label for="mes" class="block text-sm font-medium text-gray-700 mb-1">Escolha o mês:</label>
        <input type="month" id="mes" class="border rounded px-2 py-1 text-sm">
      </div>
      <button class="btn-imprimir bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" onclick="gerarTabela()">Gerar Tabela</button>
    </div>
    <div id="tabelas"></div>
    <button class="btn-nova-tabela bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded mt-4" onclick="adicionarNovaTabela()">Nova Tabela</button>
  </div>

  <footer class="container mx-auto py-6 flex">
    <img class="flex-row" src="img/legendas.png" alt="">
    <img class="flex-row ml-5" src="img/legislacao.png" alt="">
  </footer>

  <script>
    const nomesPadrao = [
      "fulano de tal",
      "fulano de tal",
      "fulano de tal",
      "fulano de tal"
    ];

    function gerarTabela(mesAno = null, container = null) {
      let data = mesAno || document.getElementById('mes').value;
      if (!data) {
        alert('Escolha um mês!');
        return;
      }
      const [ano, mes] = data.split('-').map(Number);
      const diasNoMes = new Date(ano, mes, 0).getDate();
      const nomesDias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];

      const tabela = document.createElement('table');
      tabela.className = 'tabela-escala w-full bg-white rounded shadow text-xs mb-4';

      // Cabeçalho
      const thead = tabela.createTHead();
      const trTitulo = thead.insertRow();
      const thTitulo = document.createElement('th');
      thTitulo.colSpan = diasNoMes + 4;
      thTitulo.className = 'text-center bg-blue-600 text-white text-base py-2';
      thTitulo.textContent = `${String(mes).padStart(2, '0')}/${ano}`;
      trTitulo.appendChild(thTitulo);

      const trCabecalho = thead.insertRow();
      let thNome = document.createElement('th');
      thNome.className = 'nome bg-gray-200 text-gray-700 font-semibold';
      thNome.style.width = "200px";
      // Campo editável para o nome da coluna
      let inputThNome = document.createElement('input');
      inputThNome.type = 'text';
      inputThNome.value = 'Nome';
      inputThNome.className = 'input-th-nome font-bold w-full bg-transparent outline-none';
      inputThNome.oninput = function() {
        thNome.title = inputThNome.value;
      };
      thNome.appendChild(inputThNome);
      trCabecalho.appendChild(thNome);

      for (let dia = 1; dia <= diasNoMes; dia++) {
        const dataAtual = new Date(ano, mes - 1, dia);
        const diaSemana = dataAtual.getDay();
        let th = document.createElement('th');
        th.textContent = `${dia}\n${nomesDias[diaSemana]}`;
        th.className = 'dia whitespace-pre-wrap px-0 py-1';
        th.style.width = "15px";
        if (diaSemana === 0 || diaSemana === 6) th.classList.add('bg-gray-300');
        trCabecalho.appendChild(th);
      }
      let thAuto = document.createElement('th');
      thAuto.textContent = 'Autopreencher';
      thAuto.className = 'autopreenchimento bg-gray-200 text-gray-700 font-semibold';
      thAuto.style.width = "150px";
      trCabecalho.appendChild(thAuto);

      let thExcluir = document.createElement('th');
      thExcluir.textContent = 'Excluir';
      thExcluir.className = 'excluir bg-gray-200 text-gray-700 font-semibold';
      thExcluir.style.width = "50px";
      trCabecalho.appendChild(thExcluir);

      // Corpo
      const tbody = tabela.createTBody();
      nomesPadrao.forEach((nome) => {
        adicionarLinha(tbody, diasNoMes, nome, ano, mes);
      });

      // Botão imprimir
      const btnImprimir = document.createElement('button');
      btnImprimir.textContent = 'Imprimir';
      btnImprimir.className = 'btn-imprimir bg-gray-700 hover:bg-gray-900 text-white px-3 py-1 rounded mt-2 mr-2';
      btnImprimir.onclick = function() {
        window.print();
      };

      // Botão adicionar linha
      const btnAddLinha = document.createElement('button');
      btnAddLinha.textContent = 'Adicionar Linha';
      btnAddLinha.className = 'btn-add-linha bg-blue-500 hover:bg-blue-700 text-white px-3 py-1 rounded mt-2';
      btnAddLinha.onclick = function() {
        adicionarLinha(tbody, diasNoMes, "", ano, mes);
      };

      // Adiciona tabela ao container
      const divTabela = document.createElement('div');
      divTabela.appendChild(tabela);
      divTabela.appendChild(btnImprimir);
      divTabela.appendChild(btnAddLinha);

      if (container) {
        container.appendChild(divTabela);
      } else {
        document.getElementById('tabelas').appendChild(divTabela);
      }
    }

    function adicionarLinha(tbody, diasNoMes, nome, ano, mes) {
      const tr = tbody.insertRow();
      tr.style.height = "15px";
      let tdNome = tr.insertCell();
      tdNome.className = 'nome';
      tdNome.style.width = "200px";
      let inputNome = document.createElement('input');
      inputNome.type = 'text';
      inputNome.value = nome;
      inputNome.className = 'input-nome w-full bg-transparent outline-none';
      tdNome.appendChild(inputNome);

      for (let dia = 1; dia <= diasNoMes; dia++) {
        const dataAtual = new Date(ano, mes - 1, dia);
        const diaSemana = dataAtual.getDay();
        let td = tr.insertCell();
        td.className = 'dia px-0 py-0';
        td.style.width = "15px";
        if (diaSemana === 0 || diaSemana === 6) td.classList.add('bg-gray-300');
        let input = document.createElement('input');
        input.type = 'text';
        input.maxLength = 2;
        input.className = 'input-dia w-full text-center bg-transparent outline-none';
        td.appendChild(input);
      }

      // Autopreenchimento
      let tdAuto = tr.insertCell();
      tdAuto.className = 'autopreenchimento';
      tdAuto.style.width = "150px";
      let inp1 = document.createElement('input');
      inp1.type = 'text';
      inp1.maxLength = 2;
      inp1.className = 'border rounded px-1 py-0.5 w-10 mr-1 text-center text-xs';
      let inp2 = document.createElement('input');
      inp2.type = 'text';
      inp2.maxLength = 2;
      inp2.className = 'border rounded px-1 py-0.5 w-10 mr-1 text-center text-xs';
      let btn = document.createElement('button');
      btn.textContent = 'Auto';
      btn.className = 'bg-gray-400 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs';
      btn.onclick = function() {
        const tds = tr.querySelectorAll('td.dia input');
        for (let i = 0; i < tds.length; i++) {
          if (i % 2 === 0) tds[i].value = inp1.value;
          else tds[i].value = inp2.value;
        }
      };
      tdAuto.appendChild(inp1);
      tdAuto.appendChild(inp2);
      tdAuto.appendChild(btn);

      // Botão excluir linha
      let tdExcluir = tr.insertCell();
      tdExcluir.className = 'excluir';
      tdExcluir.style.width = "50px";
      let btnExcluir = document.createElement('button');
      btnExcluir.textContent = 'X';
      btnExcluir.className = 'btn-excluir bg-red-600 hover:bg-red-800 text-white px-2 py-1 rounded text-xs ml-2';
      btnExcluir.onclick = function() {
        tr.remove();
      };
      tdExcluir.appendChild(btnExcluir);
    }

    function adicionarNovaTabela() {
      const data = document.getElementById('mes').value;
      if (!data) {
        alert('Escolha um mês!');
        return;
      }
      gerarTabela(data, document.getElementById('tabelas'));
    }
  </script>
</body>
</html>